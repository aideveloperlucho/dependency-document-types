<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Types Dependency Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: white;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        .document-type-section {
            position: absolute;
            left: 50px;
            top: 50px;
        }
        
        .document-type-label {
            color: red;
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .document-type-box {
            border: 2px solid black;
            padding: 10px 15px;
            margin: 10px 0;
            background-color: white;
            color: black;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .document-type-box:hover {
            background-color: #f0f0f0;
        }
        
        .document-type-box.highlighted {
            background-color: #ffe0e0;
        }
        
        .systems-section {
            position: absolute;
            right: 50px;
            top: 50px;
        }
        
        .system-node {
            position: absolute;
            border: 2px solid #dc3545;
            padding: 12px 18px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
            color: #dc3545;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            min-width: 160px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .system-node:hover {
            background: linear-gradient(to bottom, #fff5f5 0%, #ffe0e0 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
            border-color: #c82333;
        }
        
        .system-node.highlighted {
            background: linear-gradient(to bottom, #ffcccc 0%, #ffaaaa 100%);
            box-shadow: 0 4px 16px rgba(255, 0, 0, 0.4), 0 2px 8px rgba(0, 0, 0, 0.2);
            border-color: #c82333;
        }
        
        .system-node.highlighted-platform {
            background: linear-gradient(to bottom, #fff9cc 0%, #ffeb3b 100%);
            box-shadow: 0 4px 16px rgba(255, 204, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 3px solid #ffc107;
            transform: translateY(-2px);
            z-index: 10;
        }
        
        .asterisk {
            position: absolute;
            left: -24px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
            font-weight: bold;
            font-size: 16px;
            background: white;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid #dc3545;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .arrow {
            stroke: #dc3545;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead-red);
            filter: drop-shadow(0 2px 4px rgba(220, 53, 69, 0.4));
            transition: all 0.3s ease;
            opacity: 0.9;
        }
        
        .arrow:hover {
            stroke-width: 4;
            opacity: 1;
            filter: drop-shadow(0 3px 6px rgba(220, 53, 69, 0.5));
        }
        
        .arrow.highlighted {
            stroke-width: 4;
            stroke: #c82333;
            opacity: 1;
            filter: drop-shadow(0 3px 6px rgba(200, 35, 51, 0.6));
        }
        
        .dependency-connection {
            filter: drop-shadow(0 2px 4px rgba(220, 53, 69, 0.3));
            transition: all 0.2s ease;
        }
        
        .dependency-connection:hover {
            stroke-width: 5;
            filter: drop-shadow(0 3px 6px rgba(220, 53, 69, 0.5));
        }
        
        .connection-line {
            stroke: red;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead-red);
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 50px;
            font-size: 12px;
            color: #666;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            overflow: auto;
            animation: fadeIn 0.2s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(to bottom, #ffffff 0%, #fafafa 100%);
            margin: 3% auto;
            padding: 0;
            border: none;
            border-radius: 12px;
            width: 90%;
            max-width: 1400px;
            max-height: 90vh;
            overflow: visible;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.1);
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 30px;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        .modal-title {
            color: white;
            font-weight: 600;
            font-size: 20px;
            letter-spacing: 0.3px;
            margin: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .close-modal {
            color: white;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer;
            line-height: 1;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .close-modal:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .modal-diagram-container {
            position: relative;
            width: 100%;
            min-height: 400px;
            padding: 30px;
            background: #f8f9fa;
            flex: 1;
            overflow: auto;
        }
        
        .modal-systems-section {
            position: relative;
            width: 100%;
            min-height: 400px;
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .modal-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .modal-system-item {
            z-index: 2;
            position: relative;
        }
        
        /* Icon styles */
        .platform-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            font-size: 18px;
            vertical-align: middle;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-weight: bold;
        }
        
        .icon-check {
            color: #28a745;
            background: rgba(40, 167, 69, 0.1);
        }
        
        .icon-cancel {
            color: #dc3545;
            background: rgba(220, 53, 69, 0.1);
        }
        
        .icon-warning {
            color: #ffc107;
            background: rgba(255, 193, 7, 0.15);
        }
        
        .modal-legend {
            margin: 0;
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            font-size: 13px;
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
            position: relative;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            color: #333;
            font-weight: 500;
        }
        
        .legend-item:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }
        
        .legend-icon {
            font-size: 18px;
            font-weight: bold;
        }
        
        .legend-item span:not(.legend-icon) {
            color: #333;
            font-size: 13px;
        }
        /* Filter section styles */
        .filter-section {
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            background-color: #f5f5f5;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            z-index: 100;
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 200px;
        }
        
        .filter-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
            font-size: 12px;
        }
        
        .filter-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 14px;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: red;
        }
        
        /* Grid section styles */
        .grid-section {
            position: absolute;
            top: 120px;
            left: 50px;
            right: 50px;
            bottom: 50px;
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 5px;
            overflow: auto;
            z-index: 50;
        }
        
        .grid-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .grid-table thead {
            background-color: #f0f0f0;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .grid-table th {
            padding: 10px;
            text-align: left;
            border-bottom: 2px solid #ddd;
            font-weight: bold;
            color: #333;
        }
        
        .grid-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
        }
        
        .grid-table tbody tr:hover {
            background-color: #f9f9f9;
        }
        
        .grid-table tbody tr:nth-child(even) {
            background-color: #fafafa;
        }
        
        .grid-table tbody tr:nth-child(even):hover {
            background-color: #f0f0f0;
        }
        
        .no-results {
            padding: 50px;
            text-align: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-row">
            <div class="filter-group">
                <label class="filter-label" for="filter-itemType">ItemType(AS IS)</label>
                <input type="text" id="filter-itemType" class="filter-input" placeholder="Filter by ItemType...">
            </div>
            <div class="filter-group">
                <label class="filter-label" for="filter-documentType">TipoDocumentos(AS IS) CM v2</label>
                <input type="text" id="filter-documentType" class="filter-input" placeholder="Filter by Document Type...">
            </div>
            <div class="filter-group">
                <label class="filter-label" for="filter-platform">Plataforma que lo usa</label>
                <input type="text" id="filter-platform" class="filter-input" placeholder="Filter by Platform...">
            </div>
            <div class="filter-group" style="justify-content: flex-end;">
                <button id="clear-filters" style="padding: 8px 15px; background-color: #666; color: white; border: none; border-radius: 3px; cursor: pointer; margin-top: 20px;">
                    Clear Filters
                </button>
            </div>
        </div>
    </div>
    
    <!-- Grid Section -->
    <div class="grid-section">
        <table class="grid-table">
            <thead>
                <tr>
                    <th>ItemType(AS IS)</th>
                    <th>TipoDocumentos(AS IS) CM v2</th>
                    <th>Plataforma que lo usa</th>
                </tr>
            </thead>
            <tbody id="grid-body">
                <!-- Grid rows will be populated here -->
            </tbody>
        </table>
        <div id="no-results" class="no-results" style="display: none;">
            No results found matching the filters.
        </div>
    </div>
    
    <!-- Old visualization container (hidden by default, can be shown with a toggle if needed) -->
    <div class="container" style="display: none;">
        <svg id="svg-container" width="100%" height="100%" style="position: absolute; top: 0; left: 0; z-index: 0; pointer-events: none;">
            <defs>
                <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="red" />
                </marker>
            </defs>
        </svg>
        
        <div class="document-type-section" id="document-types"></div>
        <div class="tooltip" id="tooltip"></div>
        <div class="legend">
            Click on a document type to see its dependency diagram
        </div>
    </div>
    
    <!-- Modal Dialog -->
    <div id="dependencyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Dependency Diagram</div>
                <span class="close-modal" id="closeModal">&times;</span>
            </div>
            <div class="modal-diagram-container">
                <svg id="modal-svg" class="modal-svg">
                    <defs>
                        <marker id="modal-arrowhead-red" markerWidth="12" markerHeight="12" refX="12" refY="3.5" orient="auto" markerUnits="userSpaceOnUse">
                            <polygon points="0 0, 12 3.5, 0 7" fill="#dc3545" stroke="#c82333" stroke-width="1" />
                        </marker>
                    </defs>
                </svg>
                <div class="modal-systems-section" id="modal-systems"></div>
            </div>
            <div class="modal-legend" id="modal-legend">
                <div class="legend-item">
                    <span class="legend-icon icon-check">✓</span>
                    <span>Obligatorio (SI)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon icon-cancel">✗</span>
                    <span>No Obligatorio (NO)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon icon-warning">⚠</span>
                    <span>Condicional/Otro</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Embedded data to avoid CORS issues when opening file directly
        const embeddedData = {
        "documentTypes": [
                "Informe Tecnico",
                "Acta de entrega",
                "Atencion medica",
                "Autorización de Entrega (Acreedor)",
                "Boleta de Transporte",
                "Carta de saldo insoluto y compromiso alzamiento",
                "Cedula de Identidad(Otros)",
                "Certificado Perdida Total",
                "Certificado de Anotaciones Vigentes",
                "Certificado de pago multas",
                "Certificado de viajes",
                "Comprobante Grúa",
                "Comprobante de Ingreso",
                "Comprobante de testigos",
                "Comprobante llaves/GPS",
                "Constancia / Parte Policial",
                "Cuestionario Completo",
                "Declaración Jurada Simple",
                "Denuncia Policial",
                "Documentos Consultas Reclamos",
                "Documentos Genérico",
                "Documentos Ingreso Reingreso",
                "Documentos Inspección Taller",
                "Documentos Seguimiento Reparación",
                "Documentos solicitados a cliente (cuestionarios, recibos, \ndeclaraciones, alcotest, etc)",
                "Documentos que proporcionen evidencia del recupero",
                "Finiquito",
                "Fotografías Adicionales del Siniestro",
                "FotosInspeccion",
                "Fotos Seguimiento Reparacion",
                "Fotos y documentos de Impugnaciones",
                "Fotos y Videos Localización",
                "Fotos y Videos de los daños",
                "Fotos y Videos otros",
                "Frontal",
                "Guía de Despacho",
                "Guía de traslado",
                "Informe de Liquidación",
                "Inspección Liquidador",
                "Interior",
                "Kilometraje",
                "Lateral derecho (copiloto)",
                "Lateral izquierdo (conductor)",
                "Liquidación Oficial",
                "Ocurrencia del siniestro",
                "Otros",
                "Otros Daños",
                "PDF Valorización",
                "Pagaré",
                "Parte de Hallazgo del Vehículo",
                "Peritaje",
                "Permiso de circulacion",
                "Presupuesto",
                "Presupuesto Salvataje",
                "Recibo de Conformidad",
                "Respaldo Factura",
                "Respaldo Impugnación",
                "Respaldo Propuesta Impugna",
                "Respaldo Publicación",
                "Respaldo Valorización Manual",
                "Resumen Liquidador",
                "Revision tecnica homologacion",
                "Trasera",
                "Valor Comercial",
                "Voucher alcotest",
                "Cedula de Identidad",
                "Cedula de Identidad Reverso",
                "Certificado deuda de alimentos",
                "Cuestionario Cliente",
                "Cédula de quien recibe.",
                "Cédula de quien retira el VH",
                "Licencia de Conducir",
                "Licencia de Conducir Reverso",
                "Pasaporte",
                "Factura de compraventa",
                "Informe Autofact",
                "Inscripción Registro Civil.",
                "Número Vin",
                "Otro",
                "Padrón del Vehículo",
                "Patente",
                "Permiso de circulación",
                "Revisión técnica homologación",
                "Genérico",
                "Ingreso – Reingreso",
                "ILI",
                "Inspección Taller",
                "Consultas y Reclamos",
                "Recibo de conformidad",
                "NO TIENE",
                "Finiquito legalizado",
                "Inspección del lugar",
                "Entrevista personal asegurado",
                "Pasadas del tag",
                "Informe Autopista",
                "Verificar cámaras de seguridad",
                "Solicitud de participación de accidente",
                "Parte Policial (Denuncio)",
                "Parte Policial (Hallazgo)"
        ],
        "platforms": [
                "Liquidación Perdida Total",
                "Egresos",
                "MDR",
                "Web Oficiales",
                "Web Proveedores",
                "Denuncios",
                "Web Liquidacion",
                "Web oficiales",
                "DJS(Declaracion Jurada Simple)",
                "Recupero",
                "Proceso genera el informe de liquidación",
                "Fraude",
                "Control de gastos(CDG)",
                "CGS"
        ],
        "documentTypeToPlatforms": {
                "Informe Tecnico": [
                        "Fraude"
                ],
                "Acta de entrega": [
                        "Liquidación Perdida Total"
                ],
                "Atencion medica": [
                        "Liquidación Perdida Total"
                ],
                "Autorización de Entrega (Acreedor)": [
                        "Liquidación Perdida Total"
                ],
                "Boleta de Transporte": [
                        "Recupero",
                        "Liquidación Perdida Total"
                ],
                "Carta de saldo insoluto y compromiso alzamiento": [
                        "Liquidación Perdida Total"
                ],
                "Cedula de Identidad(Otros)": [
                        "Egresos"
                ],
                "Certificado Perdida Total": [
                        "Web Liquidacion"
                ],
                "Certificado de Anotaciones Vigentes": [
                        "Liquidación Perdida Total"
                ],
                "Certificado de pago multas": [
                        "Liquidación Perdida Total"
                ],
                "Certificado de viajes": [
                        "Liquidación Perdida Total"
                ],
                "Comprobante Grúa": [
                        "Recupero",
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Comprobante de Ingreso": [
                        "Web Liquidacion"
                ],
                "Comprobante de testigos": [
                        "Liquidación Perdida Total"
                ],
                "Comprobante llaves/GPS": [
                        "Liquidación Perdida Total"
                ],
                "Constancia / Parte Policial": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Cuestionario Completo": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Declaración Jurada Simple": [
                        "Denuncios",
                        "Web Liquidacion",
                        "Liquidación Perdida Total",
                        "DJS(Declaracion Jurada Simple)"
                ],
                "Denuncia Policial": [
                        "Denuncios",
                        "Liquidación Perdida Total",
                        "DJS(Declaracion Jurada Simple)"
                ],
                "Documentos Consultas Reclamos": [
                        "Web Proveedores"
                ],
                "Documentos Genérico": [
                        "Web oficiales",
                        "Web Proveedores"
                ],
                "Documentos Ingreso Reingreso": [
                        "Web Proveedores"
                ],
                "Documentos Inspección Taller": [
                        "Web Liquidacion",
                        "Web Proveedores"
                ],
                "Documentos Seguimiento Reparación": [
                        "Web Liquidacion"
                ],
                "Documentos solicitados a cliente (cuestionarios, recibos, \ndeclaraciones, alcotest, etc)": [
                        "Web Liquidacion"
                ],
                "Documentos que proporcionen evidencia del recupero": [
                        "Liquidación Perdida Total"
                ],
                "Finiquito": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Fotografías Adicionales del Siniestro": [
                        "Liquidación Perdida Total"
                ],
                "FotosInspeccion": [
                        "Web Liquidacion"
                ],
                "Fotos Seguimiento Reparacion": [
                        "Web Liquidacion"
                ],
                "Fotos y documentos de Impugnaciones": [
                        "Web Liquidacion"
                ],
                "Fotos y Videos Localización": [
                        "Denuncios",
                        "Liquidación Perdida Total"
                ],
                "Fotos y Videos de los daños": [
                        "Denuncios",
                        "Liquidación Perdida Total",
                        "DJS(Declaracion Jurada Simple)"
                ],
                "Fotos y Videos otros": [
                        "Denuncios",
                        "Liquidación Perdida Total",
                        "CGS"
                ],
                "Frontal": [
                        "Liquidación Perdida Total"
                ],
                "Guía de Despacho": [
                        "MDR",
                        "Liquidación Perdida Total"
                ],
                "Guía de traslado": [
                        "Liquidación Perdida Total"
                ],
                "Informe de Liquidación": [
                        "Liquidación Perdida Total"
                ],
                "Inspección Liquidador": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total",
                        "Control de gastos(CDG)"
                ],
                "Interior": [
                        "Liquidación Perdida Total"
                ],
                "Kilometraje": [
                        "Liquidación Perdida Total"
                ],
                "Lateral derecho (copiloto)": [
                        "Liquidación Perdida Total"
                ],
                "Lateral izquierdo (conductor)": [
                        "Liquidación Perdida Total"
                ],
                "Liquidación Oficial": [
                        "Liquidación Perdida Total"
                ],
                "Ocurrencia del siniestro": [
                        "Liquidación Perdida Total"
                ],
                "Otros": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total",
                        "Fraude",
                        "Web Proveedores"
                ],
                "Otros Daños": [
                        "Liquidación Perdida Total"
                ],
                "PDF Valorización": [
                        "Liquidación Perdida Total"
                ],
                "Pagaré": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Parte de Hallazgo del Vehículo": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Peritaje": [
                        "Web Liquidacion"
                ],
                "Permiso de circulacion": [
                        "Liquidación Perdida Total"
                ],
                "Presupuesto": [
                        "Web Liquidacion",
                        "Egresos",
                        "Web Proveedores"
                ],
                "Presupuesto Salvataje": [
                        "Web Liquidacion"
                ],
                "Recibo de Conformidad": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total",
                        "Egresos",
                        "Web Proveedores"
                ],
                "Respaldo Factura": [
                        "Liquidación Perdida Total"
                ],
                "Respaldo Impugnación": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Respaldo Propuesta Impugna": [
                        "Liquidación Perdida Total"
                ],
                "Respaldo Publicación": [
                        "Liquidación Perdida Total"
                ],
                "Respaldo Valorización Manual": [
                        "Liquidación Perdida Total"
                ],
                "Resumen Liquidador": [
                        "Denuncios"
                ],
                "Revision tecnica homologacion": [
                        "Liquidación Perdida Total"
                ],
                "Trasera": [
                        "Liquidación Perdida Total"
                ],
                "Valor Comercial": [
                        "Web Liquidacion"
                ],
                "Voucher alcotest": [
                        "Web Liquidacion",
                        "Liquidación Perdida Total"
                ],
                "Cedula de Identidad": [
                        "Liquidación Perdida Total",
                        "Egresos",
                        "Denuncios",
                        "Web Liquidacion",
                        "DJS(Declaracion Jurada Simple)",
                        "Fraude"
                ],
                "Cedula de Identidad Reverso": [
                        "Denuncios"
                ],
                "Certificado deuda de alimentos": [
                        "Liquidación Perdida Total"
                ],
                "Cuestionario Cliente": [
                        "Liquidación Perdida Total"
                ],
                "Cédula de quien recibe.": [
                        "Liquidación Perdida Total"
                ],
                "Cédula de quien retira el VH": [
                        "Liquidación Perdida Total"
                ],
                "Licencia de Conducir": [
                        "Denuncios",
                        "Web Liquidacion",
                        "Liquidación Perdida Total",
                        "DJS(Declaracion Jurada Simple)"
                ],
                "Licencia de Conducir Reverso": [
                        "Denuncios"
                ],
                "Pasaporte": [
                        "Liquidación Perdida Total"
                ],
                "Factura de compraventa": [
                        "Liquidación Perdida Total"
                ],
                "Informe Autofact": [
                        "Liquidación Perdida Total"
                ],
                "Inscripción Registro Civil.": [
                        "Liquidación Perdida Total"
                ],
                "Número Vin": [
                        "Liquidación Perdida Total"
                ],
                "Otro": [
                        "Liquidación Perdida Total"
                ],
                "Padrón del Vehículo": [
                        "Web Liquidacion"
                ],
                "Patente": [
                        "Liquidación Perdida Total"
                ],
                "Permiso de circulación": [
                        "Liquidación Perdida Total"
                ],
                "Revisión técnica homologación": [
                        "Liquidación Perdida Total"
                ],
                "Genérico": [
                        "Web Oficiales",
                        "Web Proveedores"
                ],
                "Ingreso – Reingreso": [
                        "Web Proveedores"
                ],
                "ILI": [
                        "Control de gastos(CDG)"
                ],
                "Inspección Taller": [
                        "Web Proveedores"
                ],
                "Consultas y Reclamos": [
                        "Web Proveedores"
                ],
                "Recibo de conformidad": [
                        "Egresos"
                ],
                "NO TIENE": [
                        "Liquidación Perdida Total",
                        "Web Liquidacion",
                        "Web oficiales",
                        "Proceso genera el informe de liquidación",
                        "Control de gastos(CDG)",
                        "CGS"
                ],
                "Finiquito legalizado": [
                        "Liquidación Perdida Total"
                ],
                "Inspección del lugar": [
                        "Fraude"
                ],
                "Entrevista personal asegurado": [
                        "Fraude"
                ],
                "Pasadas del tag": [
                        "Fraude"
                ],
                "Informe Autopista": [
                        "Fraude"
                ],
                "Verificar cámaras de seguridad": [
                        "Fraude"
                ],
                "Solicitud de participación de accidente": [
                        "Fraude"
                ],
                "Parte Policial (Denuncio)": [
                        "Fraude"
                ],
                "Parte Policial (Hallazgo)": [
                        "Fraude"
                ]
        },
        "documentTypePlatformDependencies": {
                "Cedula de Identidad": {
                        "Web Liquidacion": "Denuncios",
                        "Liquidación Perdida Total": "Denuncios",
                        "DJS(Declaracion Jurada Simple)": "Web Liquidacion",
                        "Fraude": "DJS(Declaracion Jurada Simple)",
                        "Egresos": "DJS(Declaracion Jurada Simple)"
                }
        },
        "documentPlatformObligationText": {
                "Informe Tecnico": {
                        "Fraude": "SI"
                },
                "Acta de entrega": {
                        "Liquidación Perdida Total": "SI"
                },
                "Atencion medica": {
                        "Liquidación Perdida Total": "SI"
                },
                "Autorización de Entrega (Acreedor)": {
                        "Liquidación Perdida Total": "Si"
                },
                "Boleta de Transporte": {
                        "Liquidación Perdida Total": "SI",
                        "Recupero": "NO"
                },
                "Carta de saldo insoluto y compromiso alzamiento": {
                        "Liquidación Perdida Total": "SI"
                },
                "Cedula de Identidad(Otros)": {
                        "Egresos": "Si"
                },
                "Certificado Perdida Total": {
                        "Web Liquidacion": "?"
                },
                "Comprobante Grúa": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "Recupero": "NO"
                },
                "Comprobante de Ingreso": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Constancia / Parte Policial": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Cuestionario Completo": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Declaración Jurada Simple": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "Denuncios": "NO",
                        "DJS(Declaracion Jurada Simple)": "Si"
                },
                "Denuncia Policial": {
                        "Denuncios": "NO",
                        "DJS(Declaracion Jurada Simple)": "Si"
                },
                "Documentos Genérico": {
                        "Web oficiales": "SI"
                },
                "Documentos Ingreso Reingreso": {
                        "Web Proveedores": "SI"
                },
                "Documentos Inspección Taller": {
                        "Web Proveedores": "NO",
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Documentos Seguimiento Reparación": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Documentos solicitados a cliente (cuestionarios, recibos, \ndeclaraciones, alcotest, etc)": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Finiquito": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "FotosInspeccion": {
                        "Web Liquidacion": "SI"
                },
                "Fotos Seguimiento Reparacion": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Fotos y documentos de Impugnaciones": {
                        "Web Liquidacion": "SI"
                },
                "Fotos y Videos Localización": {
                        "Denuncios": "NO"
                },
                "Fotos y Videos de los daños": {
                        "DJS(Declaracion Jurada Simple)": "Si",
                        "Denuncios": "NO"
                },
                "Fotos y Videos otros": {
                        "CGS": "NO",
                        "Denuncios": "NO"
                },
                "Guía de Despacho": {
                        "MDR": "NO"
                },
                "Inspección Liquidador": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "Control de gastos(CDG)": "SI"
                },
                "Otros": {
                        "Web Proveedores": "NO SE USA",
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "Fraude": "SI"
                },
                "Pagaré": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Parte de Hallazgo del Vehículo": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Peritaje": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Presupuesto": {
                        "Web Proveedores": "Si",
                        "Egresos": "Si",
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Presupuesto Salvataje": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Recibo de Conformidad": {
                        "Web Proveedores": "Si",
                        "Egresos": "Si",
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Respaldo Impugnación": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Respaldo Publicación": {
                        "Liquidación Perdida Total": "SI"
                },
                "Resumen Liquidador": {
                        "Denuncios": "NO"
                },
                "Valor Comercial": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Voucher alcotest": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo LAGL."
                },
                "Cedula de Identidad": {
                        "Web Liquidacion": "NO, a menos que el liquidador los \nsolicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "Denuncios": "SI",
                        "DJS(Declaracion Jurada Simple)": "SI",
                        "Egresos": "Si"
                },
                "Cedula de Identidad Reverso": {
                        "Denuncios": "SI"
                },
                "Licencia de Conducir": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo.",
                        "DJS(Declaracion Jurada Simple)": "SI",
                        "Liquidación Perdida Total": "SI",
                        "Denuncios": "SI"
                },
                "Licencia de Conducir Reverso": {
                        "Denuncios": "SI"
                },
                "Padrón del Vehículo": {
                        "Web Liquidacion": "NO, a menos que el liquidador los solicite, entonces el formulario enviado al cliente obligara a subirlo."
                },
                "Genérico": {
                        "Web Proveedores": "SI",
                        "Web Oficiales": "SI"
                },
                "Ingreso – Reingreso": {
                        "Web Proveedores": "SI"
                },
                "ILI": {
                        "Control de gastos(CDG)": "SI"
                },
                "Inspección Taller": {
                        "Web Proveedores": "NO"
                },
                "Recibo de conformidad": {
                        "Egresos": "Si"
                },
                "NO TIENE": {
                        "Web Liquidacion": "Si",
                        "Control de gastos(CDG)": "SI",
                        "CGS": "SI",
                        "Web oficiales": "SI"
                },
                "Finiquito legalizado": {
                        "Liquidación Perdida Total": "Si"
                },
                "Inspección del lugar": {
                        "Fraude": "SI"
                },
                "Entrevista personal asegurado": {
                        "Fraude": "SI"
                },
                "Pasadas del tag": {
                        "Fraude": "SI"
                },
                "Informe Autopista": {
                        "Fraude": "SI"
                },
                "Verificar cámaras de seguridad": {
                        "Fraude": "SI"
                },
                "Solicitud de participación de accidente": {
                        "Fraude": "SI"
                },
                "Parte Policial (Denuncio)": {
                        "Fraude": "SI"
                },
                "Parte Policial (Hallazgo)": {
                        "Fraude": "SI"
                }
        },
        "platformDependencies": {},
        "platformIconStatus": {
                "Fraude": "SI",
                "Liquidación Perdida Total": "SI",
                "Gestor Documental": "OTHER",
                "Recupero": "OTHER",
                "Egresos": "SI",
                "Web Liquidacion": "OTHER",
                "Denuncios": "OTHER",
                "DJS(Declaracion Jurada Simple)": "SI",
                "Web oficiales": "SI",
                "Web Proveedores": "OTHER",
                "CGS": "OTHER",
                "MDR": "NO",
                "Control de gastos(CDG)": "SI",
                "Web Oficiales": "SI"
        },
        "gridData": [
                {
                        "itemType": "Fraude",
                        "documentType": "Informe Tecnico",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Acta de entrega",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Atencion medica",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Autorización de Entrega (Acreedor)",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Boleta de Transporte",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Boleta de Transporte",
                        "platform": "Recupero"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Carta de saldo insoluto y compromiso alzamiento",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Cedula de Identidad(Otros)",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Certificado Perdida Total",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Certificado de Anotaciones Vigentes",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Certificado de pago multas",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Certificado de viajes",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante Grúa",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante Grúa",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante Grúa",
                        "platform": "Recupero"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante de Ingreso",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante de testigos",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Comprobante llaves/GPS",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Constancia / Parte Policial",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Constancia / Parte Policial",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Cuestionario Completo",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Cuestionario Completo",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Declaración Jurada Simple",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Declaración Jurada Simple",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Declaración Jurada Simple",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Declaración Jurada Simple",
                        "platform": "DJS(Declaracion Jurada Simple)"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Denuncia Policial",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Denuncia Policial",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Denuncia Policial",
                        "platform": "DJS(Declaracion Jurada Simple)"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Consultas Reclamos",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Genérico",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Genérico",
                        "platform": "Web oficiales"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Ingreso Reingreso",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Inspección Taller",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Inspección Taller",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos Seguimiento Reparación",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos solicitados a cliente (cuestionarios, recibos, \ndeclaraciones, alcotest, etc)",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Documentos que proporcionen evidencia del recupero",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Finiquito",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Finiquito",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotografías Adicionales del Siniestro",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "FotosInspeccion",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos Seguimiento Reparacion",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y documentos de Impugnaciones",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos Localización",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos Localización",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos de los daños",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos de los daños",
                        "platform": "DJS(Declaracion Jurada Simple)"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos de los daños",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos otros",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos otros",
                        "platform": "CGS"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Fotos y Videos otros",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Frontal",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Guía de Despacho",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Guía de Despacho",
                        "platform": "MDR"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Guía de traslado",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Informe de Liquidación",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Inspección Liquidador",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Inspección Liquidador",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Inspección Liquidador",
                        "platform": "Control de gastos(CDG)"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Interior",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Kilometraje",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Lateral derecho (copiloto)",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Lateral izquierdo (conductor)",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Liquidación Oficial",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Ocurrencia del siniestro",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Otros",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Otros",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Otros",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Otros Daños",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "PDF Valorización",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Pagaré",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Pagaré",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Parte de Hallazgo del Vehículo",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Parte de Hallazgo del Vehículo",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Peritaje",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Permiso de circulacion",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Presupuesto",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Presupuesto",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Presupuesto",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Presupuesto Salvataje",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Recibo de Conformidad",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Recibo de Conformidad",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Recibo de Conformidad",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Recibo de Conformidad",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Factura",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Impugnación",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Impugnación",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Propuesta Impugna",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Publicación",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Respaldo Valorización Manual",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Resumen Liquidador",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Revision tecnica homologacion",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Trasera",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Valor Comercial",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Voucher alcotest",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Voucher alcotest",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad",
                        "platform": "DJS(Declaracion Jurada Simple)"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cedula de Identidad Reverso",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Certificado deuda de alimentos",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cuestionario Cliente",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cédula de quien recibe.",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Cédula de quien retira el VH",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Licencia de Conducir",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Licencia de Conducir",
                        "platform": "DJS(Declaracion Jurada Simple)"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Licencia de Conducir",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Licencia de Conducir",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Licencia de Conducir Reverso",
                        "platform": "Denuncios"
                },
                {
                        "itemType": "Personas",
                        "documentType": "Pasaporte",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Certificado de Anotaciones Vigentes",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Factura de compraventa",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Frontal",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Informe Autofact",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Inscripción Registro Civil.",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Interior",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Kilometraje",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Lateral derecho (copiloto)",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Lateral izquierdo (conductor)",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Número Vin",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Otro",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Padrón del Vehículo",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Patente",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Permiso de circulación",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Revisión técnica homologación",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Vehiculo",
                        "documentType": "Trasera",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Taller",
                        "documentType": "Genérico",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Ingreso – Reingreso",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "ILI",
                        "platform": "Control de gastos(CDG)"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Inspección Taller",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Genérico",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Genérico",
                        "platform": "Web Oficiales"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Recibo de Conformidad",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Presupuesto",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Consultas y Reclamos",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "SistemasSiniestros",
                        "documentType": "Otros",
                        "platform": "Web Proveedores"
                },
                {
                        "itemType": "Antecedentes",
                        "documentType": "Presupuesto",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Antecedentes",
                        "documentType": "Recibo de conformidad",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Antecedentes",
                        "documentType": "Cedula de Identidad",
                        "platform": "Egresos"
                },
                {
                        "itemType": "Poliza",
                        "documentType": "NO TIENE",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Poliza",
                        "documentType": "NO TIENE",
                        "platform": "Web Liquidacion"
                },
                {
                        "itemType": "Poliza",
                        "documentType": "NO TIENE",
                        "platform": "Control de gastos(CDG)"
                },
                {
                        "itemType": "Poliza",
                        "documentType": "NO TIENE",
                        "platform": "CGS"
                },
                {
                        "itemType": "DocPago",
                        "documentType": "NO TIENE",
                        "platform": "Web oficiales"
                },
                {
                        "itemType": "DocPago",
                        "documentType": "NO TIENE",
                        "platform": "Proceso genera el informe de liquidación"
                },
                {
                        "itemType": "Siniestro",
                        "documentType": "Finiquito legalizado",
                        "platform": "Liquidación Perdida Total"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Inspección del lugar",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Entrevista personal asegurado",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Pasadas del tag",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Informe Autopista",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Verificar cámaras de seguridad",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Solicitud de participación de accidente",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Parte Policial (Denuncio)",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Parte Policial (Hallazgo)",
                        "platform": "Fraude"
                },
                {
                        "itemType": "Fraude",
                        "documentType": "Otros",
                        "platform": "Fraude"
                }
        ]
};

        // Initialize with embedded data
        const data = embeddedData;
        
        // Store global references for reuse
        let globalPlatformNodes = null;
        let globalPlatformPositions = null;
        let globalPlatformEdges = null;
        let globalDocToPlatforms = null;
        
        initializeVisualization();
        initializeGrid();

        function initializeGrid() {
            // Get grid data
            const gridData = data.gridData || [];
            const gridBody = document.getElementById('grid-body');
            const noResults = document.getElementById('no-results');
            
            // Filter inputs
            const filterItemType = document.getElementById('filter-itemType');
            const filterDocumentType = document.getElementById('filter-documentType');
            const filterPlatform = document.getElementById('filter-platform');
            const clearFiltersBtn = document.getElementById('clear-filters');
            
            // Function to render grid
            function renderGrid(filteredData) {
                gridBody.innerHTML = '';
                
                if (filteredData.length === 0) {
                    noResults.style.display = 'block';
                    return;
                }
                
                noResults.style.display = 'none';
                
                filteredData.forEach(row => {
                    const tr = document.createElement('tr');
                    
                    // ItemType cell
                    const itemTypeCell = document.createElement('td');
                    itemTypeCell.textContent = row.itemType || '';
                    tr.appendChild(itemTypeCell);
                    
                    // DocumentType cell (clickable)
                    const docTypeCell = document.createElement('td');
                    docTypeCell.textContent = row.documentType || '';
                    docTypeCell.style.cursor = 'pointer';
                    docTypeCell.style.color = '#0066cc';
                    docTypeCell.style.textDecoration = 'underline';
                    docTypeCell.title = 'Click to see dependency diagram';
                    docTypeCell.addEventListener('click', () => {
                        // Get platforms for this document type
                        const platforms = data.documentTypeToPlatforms && data.documentTypeToPlatforms[row.documentType] || [];
                        // Get the platform from this specific row to highlight
                        const platformToHighlight = row.platform || null;
                        // Show the dependency diagram modal with platform highlight
                        showDependencyDiagramInModal(row.documentType, platforms, platformToHighlight);
                    });
                    docTypeCell.addEventListener('mouseenter', () => {
                        docTypeCell.style.color = '#004499';
                    });
                    docTypeCell.addEventListener('mouseleave', () => {
                        docTypeCell.style.color = '#0066cc';
                    });
                    tr.appendChild(docTypeCell);
                    
                    // Platform cell
                    const platformCell = document.createElement('td');
                    platformCell.textContent = row.platform || '';
                    tr.appendChild(platformCell);
                    
                    gridBody.appendChild(tr);
                });
            }
            
            // Function to filter data
            function filterData() {
                const itemTypeFilter = filterItemType.value.toLowerCase().trim();
                const documentTypeFilter = filterDocumentType.value.toLowerCase().trim();
                const platformFilter = filterPlatform.value.toLowerCase().trim();
                
                const filtered = gridData.filter(row => {
                    const itemTypeMatch = !itemTypeFilter || 
                        (row.itemType || '').toLowerCase().includes(itemTypeFilter);
                    const documentTypeMatch = !documentTypeFilter || 
                        (row.documentType || '').toLowerCase().includes(documentTypeFilter);
                    const platformMatch = !platformFilter || 
                        (row.platform || '').toLowerCase().includes(platformFilter);
                    
                    return itemTypeMatch && documentTypeMatch && platformMatch;
                });
                
                renderGrid(filtered);
            }
            
            // Add event listeners
            filterItemType.addEventListener('input', filterData);
            filterDocumentType.addEventListener('input', filterData);
            filterPlatform.addEventListener('input', filterData);
            
            clearFiltersBtn.addEventListener('click', () => {
                filterItemType.value = '';
                filterDocumentType.value = '';
                filterPlatform.value = '';
                filterData();
            });
            
            // Initial render
            renderGrid(gridData);
        }

        function initializeVisualization() {
            const svg = d3.select('#svg-container');
            const documentTypesDiv = d3.select('#document-types');
            const systemsDiv = d3.select('#systems');
            
            // Build platform dependency graph
            const platformNodes = new Map();
            const platformEdges = [];
            
            // Add all platforms as nodes
            data.platforms.forEach(platform => {
                platformNodes.set(platform, {
                    name: platform,
                    x: 0,
                    y: 0,
                    dependencies: []
                });
            });
            
            // Add dependency edges
            Object.entries(data.platformDependencies).forEach(([platform, dependsOn]) => {
                if (platformNodes.has(platform) && platformNodes.has(dependsOn)) {
                    platformEdges.push({
                        source: dependsOn,
                        target: platform
                    });
                    platformNodes.get(platform).dependencies.push(dependsOn);
                }
            });
            
            // Layout platforms using a hierarchical layout
            const platformPositions = layoutPlatforms(platformNodes, platformEdges);
            
            // Render document types on the left
            renderDocumentTypes(documentTypesDiv, data.documentTypes, data.documentTypeToPlatforms);
            
            // Store edges globally
            globalPlatformEdges = platformEdges;
            
            // Systems will be rendered in modal when a document type is clicked
        }
        
        function layoutPlatforms(nodes, edges) {
            // Simple hierarchical layout
            const positions = new Map();
            const levels = new Map();
            const visited = new Set();
            
            // Find root nodes (nodes with no dependencies)
            const rootNodes = Array.from(nodes.keys()).filter(node => {
                return !Array.from(nodes.values()).some(n => n.dependencies.includes(node));
            });
            
            // If no clear roots, use nodes with most dependencies pointing to them
            if (rootNodes.length === 0) {
                const inDegree = new Map();
                Array.from(nodes.keys()).forEach(node => inDegree.set(node, 0));
                edges.forEach(edge => {
                    inDegree.set(edge.target, (inDegree.get(edge.target) || 0) + 1);
                });
                rootNodes.push(...Array.from(inDegree.entries())
                    .sort((a, b) => a[1] - b[1])
                    .slice(0, 1)
                    .map(e => e[0]));
            }
            
            // BFS to assign levels
            const queue = rootNodes.map(node => ({ node, level: 0 }));
            queue.forEach(item => levels.set(item.node, item.level));
            
            while (queue.length > 0) {
                const { node, level } = queue.shift();
                if (visited.has(node)) continue;
                visited.add(node);
                
                edges.filter(e => e.source === node).forEach(edge => {
                    if (!levels.has(edge.target)) {
                        levels.set(edge.target, level + 1);
                        queue.push({ node: edge.target, level: level + 1 });
                    }
                });
            }
            
            // Position nodes by level
            const nodesByLevel = new Map();
            Array.from(levels.entries()).forEach(([node, level]) => {
                if (!nodesByLevel.has(level)) {
                    nodesByLevel.set(level, []);
                }
                nodesByLevel.get(level).push(node);
            });
            
            const containerWidth = window.innerWidth - 200;
            const containerHeight = window.innerHeight - 100;
            const startX = containerWidth - 300;
            const startY = 100;
            const levelSpacing = 250;
            const nodeSpacing = 80;
            
            Array.from(nodesByLevel.entries())
                .sort((a, b) => a[0] - b[0])
                .forEach(([level, levelNodes]) => {
                    const yOffset = (levelNodes.length - 1) * nodeSpacing / 2;
                    levelNodes.forEach((node, idx) => {
                        positions.set(node, {
                            x: startX - (level * levelSpacing),
                            y: startY + (idx * nodeSpacing) - yOffset
                        });
                    });
                });
            
            // Position any unassigned nodes
            Array.from(nodes.keys()).forEach(node => {
                if (!positions.has(node)) {
                    positions.set(node, {
                        x: startX,
                        y: startY + Array.from(positions.values()).length * nodeSpacing
                    });
                }
            });
            
            return positions;
        }
        
        function renderDocumentTypes(container, documentTypes, docToPlatforms) {
            const tooltip = d3.select('#tooltip');
            
            // Add "Document type" label
            container.append('div')
                .attr('class', 'document-type-label')
                .text('Document type');
            
            container.selectAll('.document-type-item')
                .data(documentTypes)
                .enter()
                .append('div')
                .attr('class', 'document-type-item')
                .append('div')
                .attr('class', 'document-type-box')
                .text(d => d)
                .on('mouseenter', function(event, d) {
                    d3.select(this).classed('highlighted', true);
                    const platforms = docToPlatforms[d] || [];
                    tooltip
                        .style('display', 'block')
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 10) + 'px')
                        .html(`<strong>${d}</strong><br/>Used by: ${platforms.join(', ')}`);
                    
                    // Highlight connected platforms
                    highlightPlatforms(platforms, true);
                })
                .on('mouseleave', function() {
                    d3.select(this).classed('highlighted', false);
                    tooltip.style('display', 'none');
                    highlightPlatforms([], false);
                })
                .on('click', function(event, d) {
                    const platforms = docToPlatforms[d] || [];
                    // Hide tooltip
                    tooltip.style('display', 'none');
                    // Highlight the selected document type
                    d3.selectAll('.document-type-box').classed('highlighted', false);
                    d3.select(this).classed('highlighted', true);
                    // Show the dependency diagram in modal
                    showDependencyDiagramInModal(d, platforms, null);
                });
        }
        
        function renderSystems(container, nodes, positions, docToPlatforms) {
            const tooltip = d3.select('#tooltip');
            
            // Store for later use
            globalPlatformNodes = nodes;
            globalPlatformPositions = positions;
            globalDocToPlatforms = docToPlatforms;
            
            // Clear existing systems
            container.selectAll('.system-item').remove();
            
            // Initially hide all systems - they will be shown when a document type is clicked
            // We'll create them but hide them
            container.selectAll('.system-item')
                .data(Array.from(nodes.entries()))
                .enter()
                .append('div')
                .attr('class', 'system-item')
                .style('display', 'none')
                .each(function([name, nodeData]) {
                    const pos = positions.get(name);
                    if (!pos) return;
                    
                    const systemDiv = d3.select(this)
                        .append('div')
                        .attr('class', 'system-node')
                        .style('left', pos.x + 'px')
                        .style('top', pos.y + 'px')
                        .attr('data-platform', name);
                    
                    // Add asterisk if this platform has dependencies
                    if (nodeData.dependencies.length > 0) {
                        systemDiv.append('span')
                            .attr('class', 'asterisk')
                            .text('*'.repeat(nodeData.dependencies.length));
                    }
                    
                    systemDiv.append('span')
                        .text(name);
                });
        }
        
        function showDependencyDiagramInModal(documentType, selectedPlatforms, platformToHighlight = null) {
            // Open the modal
            const modal = document.getElementById('dependencyModal');
            const modalTitle = document.getElementById('modalTitle');
            modalTitle.textContent = `Dependency Diagram: ${documentType}`;
            modal.style.display = 'block';
            
            // Clear previous content
            const modalSystems = d3.select('#modal-systems');
            const modalSvg = d3.select('#modal-svg');
            modalSystems.selectAll('*').remove();
            modalSvg.selectAll('*').remove(); // Clear all SVG elements, not just paths
            
            // Remove any existing tooltips
            d3.selectAll('.obligation-tooltip').remove();
            
            if (!selectedPlatforms || selectedPlatforms.length === 0) {
                modalSystems.append('div')
                    .style('text-align', 'center')
                    .style('padding', '50px')
                    .style('color', '#666')
                    .text('No platforms found for this document type');
                return;
            }
            
            // Build the dependency chain following the logic:
            // 1. Start with platforms from "Plataforma que lo usa" (selectedPlatforms)
            // 2. For each platform, check "Cual sistema/portal lo debio haber subido" 
            //    from documentTypePlatformDependencies (document-type-specific)
            // 3. Continue upstream until no more dependencies exist
            const platformsToShow = new Set(selectedPlatforms);
            const edgesToShow = [];
            const visited = new Set();
            
            // Get document-type-specific dependencies
            const docTypeDeps = data.documentTypePlatformDependencies && data.documentTypePlatformDependencies[documentType] || {};
            
            // Recursive function to follow upstream dependencies for this specific document type
            function addUpstreamDependencies(platform) {
                if (visited.has(platform)) return;
                visited.add(platform);
                platformsToShow.add(platform);
                
                // Check if this platform has an upstream dependency for THIS document type
                // Only use dependency if it exists in the document-type-specific mapping
                if (docTypeDeps[platform]) {
                    const upstreamDep = docTypeDeps[platform];
                    platformsToShow.add(upstreamDep);
                    edgesToShow.push({ source: upstreamDep, target: platform });
                    // Recursively follow the chain (checking the same document type's dependencies)
                    addUpstreamDependencies(upstreamDep);
                }
            }
            
            // Start with all selected platforms and follow their upstream chains
            selectedPlatforms.forEach(platform => {
                addUpstreamDependencies(platform);
            });
            
            // Also show connections between platforms that are both in selectedPlatforms
            // (if one selected platform depends on another selected platform for this document type)
            selectedPlatforms.forEach(platform => {
                if (docTypeDeps[platform]) {
                    const dep = docTypeDeps[platform];
                    if (selectedPlatforms.includes(dep)) {
                        // Both are selected, ensure the edge is shown
                        const edgeExists = edgesToShow.some(e => e.source === dep && e.target === platform);
                        if (!edgeExists) {
                            edgesToShow.push({ source: dep, target: platform });
                        }
                    }
                }
            });
            
            // Debug: Log edges to verify they're being created
            console.log('Document Type:', documentType);
            console.log('Selected Platforms:', selectedPlatforms);
            console.log('Document Type Dependencies:', docTypeDeps);
            console.log('Edges to Show:', edgesToShow);
            console.log('Platforms to Show:', Array.from(platformsToShow));
            
            // Wait for modal to be visible, then calculate positions
            setTimeout(() => {
                // Get container dimensions after modal is visible
                const containerRect = modalSystems.node().getBoundingClientRect();
                const containerWidth = containerRect.width || 1000;
                
                // Calculate positions with container width
                const visiblePositions = layoutVisiblePlatforms(Array.from(platformsToShow), edgesToShow, containerWidth);
                
                const containerHeight = Math.max(500, Array.from(platformsToShow).length * 100);
                modalSystems.style('height', containerHeight + 'px');
                modalSvg
                    .attr('width', containerWidth)
                    .attr('height', containerHeight);
                
                // Create a shared tooltip element once (outside the loop to avoid duplicates)
                let sharedTooltip = d3.select('.obligation-tooltip');
                if (sharedTooltip.empty()) {
                    sharedTooltip = d3.select('body').append('div')
                        .attr('class', 'obligation-tooltip')
                        .style('position', 'absolute')
                        .style('background-color', 'rgba(0, 0, 0, 0.9)')
                        .style('color', 'white')
                        .style('padding', '8px 12px')
                        .style('border-radius', '4px')
                        .style('font-size', '12px')
                        .style('max-width', '400px')
                        .style('z-index', '10000')
                        .style('pointer-events', 'none')
                        .style('display', 'none')
                        .style('white-space', 'pre-wrap')
                        .style('box-shadow', '0 2px 8px rgba(0,0,0,0.3)');
                }
                
                // Render systems in modal
                const systemItems = modalSystems.selectAll('.modal-system-item')
                    .data(Array.from(platformsToShow))
                    .enter()
                    .append('div')
                    .attr('class', 'modal-system-item')
                    .style('position', 'absolute');
                
                systemItems.each(function(platform) {
                    const pos = visiblePositions.get(platform);
                    if (!pos) return;
                    
                    // Check if this platform should be highlighted
                    const shouldHighlight = platformToHighlight && platform === platformToHighlight;
                    
                    const systemDiv = d3.select(this)
                        .append('div')
                        .attr('class', shouldHighlight ? 'system-node highlighted-platform' : 'system-node')
                        .style('left', (pos.x) + 'px')
                        .style('top', (pos.y) + 'px')
                        .attr('data-platform', platform);
                    
                    // Check if this platform has dependencies
                    const hasDependency = edgesToShow.some(e => e.target === platform);
                    if (hasDependency) {
                        systemDiv.append('span')
                            .attr('class', 'asterisk')
                            .text('*');
                    }
                    
                    systemDiv.append('span')
                        .text(platform);
                    
                    // Add icon based on obligation status
                    const iconStatus = data.platformIconStatus && data.platformIconStatus[platform];
                    if (iconStatus) {
                        const iconSpan = systemDiv.append('span')
                            .attr('class', 'platform-icon');
                        
                        if (iconStatus === 'SI') {
                            iconSpan.attr('class', 'platform-icon icon-check')
                                .text('✓');
                        } else if (iconStatus === 'NO') {
                            iconSpan.attr('class', 'platform-icon icon-cancel')
                                .text('✗');
                        } else if (iconStatus === 'OTHER') {
                            iconSpan.attr('class', 'platform-icon icon-warning')
                                .text('⚠')
                                .style('cursor', 'help');
                            
                            // Add tooltip with obligation text for this document type + platform
                            const obligationText = data.documentPlatformObligationText && 
                                data.documentPlatformObligationText[documentType] && 
                                data.documentPlatformObligationText[documentType][platform];
                            
                            if (obligationText) {
                                // Use the shared tooltip element (created outside the loop)
                                // Note: We don't use the native 'title' attribute to avoid showing two tooltips
                                iconSpan
                                    .on('mouseenter', function(event) {
                                        sharedTooltip
                                            .text(obligationText)
                                            .style('display', 'block')
                                            .style('left', (event.pageX + 10) + 'px')
                                            .style('top', (event.pageY - 10) + 'px');
                                    })
                                    .on('mousemove', function(event) {
                                        sharedTooltip
                                            .style('left', (event.pageX + 10) + 'px')
                                            .style('top', (event.pageY - 10) + 'px');
                                    })
                                    .on('mouseleave', function() {
                                        sharedTooltip.style('display', 'none');
                                    });
                            }
                        }
                    }
                });
                
                // Draw arrows - wait longer to ensure nodes are fully rendered and positioned
                setTimeout(() => {
                    // Ensure SVG is properly sized
                    const containerRect = modalSystems.node().getBoundingClientRect();
                    modalSvg
                        .attr('width', containerRect.width)
                        .attr('height', containerRect.height);
                    
                    drawDependencyArrowsInModal(edgesToShow, visiblePositions, modalSystems, modalSvg);
                }, 150);
            }, 10);
        }
        
        function showDependencyDiagram(selectedPlatforms) {
            // Hide all systems first
            d3.selectAll('.system-item').style('display', 'none');
            d3.selectAll('.arrow').remove();
            
            if (!selectedPlatforms || selectedPlatforms.length === 0) {
                return;
            }
            
            // Build the dependency chain starting from selected platforms
            const platformsToShow = new Set(selectedPlatforms);
            const edgesToShow = [];
            
            // Add all platforms in the dependency chain
            const visited = new Set();
            const toProcess = [...selectedPlatforms];
            
            while (toProcess.length > 0) {
                const platform = toProcess.shift();
                if (visited.has(platform)) continue;
                visited.add(platform);
                
                // Add this platform to show
                platformsToShow.add(platform);
                
                // Find platforms this one depends on (trace backwards - what must come before)
                if (data.platformDependencies && data.platformDependencies[platform]) {
                    const dep = data.platformDependencies[platform];
                    if (!visited.has(dep)) {
                        toProcess.push(dep);
                        platformsToShow.add(dep);
                        edgesToShow.push({ source: dep, target: platform });
                    }
                }
                
                // Find platforms that depend on this one (trace forwards - what comes after)
                // Show full chain if any selected platform is in the chain
                Object.entries(data.platformDependencies || {}).forEach(([p, dep]) => {
                    if (dep === platform && !visited.has(p)) {
                        toProcess.push(p);
                        platformsToShow.add(p);
                        edgesToShow.push({ source: platform, target: p });
                    }
                });
            }
            
            // Show only relevant systems
            d3.selectAll('.system-item')
                .filter(function() {
                    const platform = d3.select(this).select('.system-node').attr('data-platform');
                    return platformsToShow.has(platform);
                })
                .style('display', 'block');
            
            // Calculate new positions for visible systems only
            const visiblePositions = layoutVisiblePlatforms(Array.from(platformsToShow), edgesToShow, undefined);
            
            // Update positions
            d3.selectAll('.system-item')
                .filter(function() {
                    const platform = d3.select(this).select('.system-node').attr('data-platform');
                    return platformsToShow.has(platform);
                })
                .each(function() {
                    const platform = d3.select(this).select('.system-node').attr('data-platform');
                    const pos = visiblePositions.get(platform);
                    if (pos) {
                        d3.select(this)
                            .select('.system-node')
                            .style('left', pos.x + 'px')
                            .style('top', pos.y + 'px');
                    }
                });
            
            // Draw arrows for the dependency flow
            setTimeout(() => {
                drawDependencyArrowsForVisible(edgesToShow, visiblePositions);
            }, 50);
        }
        
        function layoutVisiblePlatforms(platforms, edges, containerWidth) {
            const positions = new Map();
            const levels = new Map();
            const visited = new Set();
            
            // Find root nodes (nodes with no incoming edges in the visible set)
            const rootNodes = platforms.filter(platform => {
                return !edges.some(e => e.target === platform);
            });
            
            // If no clear roots, use the first platform
            if (rootNodes.length === 0 && platforms.length > 0) {
                rootNodes.push(platforms[0]);
            }
            
            // BFS to assign levels
            const queue = rootNodes.map(node => ({ node, level: 0 }));
            queue.forEach(item => levels.set(item.node, item.level));
            
            while (queue.length > 0) {
                const { node, level } = queue.shift();
                if (visited.has(node)) continue;
                visited.add(node);
                
                edges.filter(e => e.source === node).forEach(edge => {
                    if (!levels.has(edge.target)) {
                        levels.set(edge.target, level + 1);
                        queue.push({ node: edge.target, level: level + 1 });
                    }
                });
            }
            
            // Position nodes by level
            const nodesByLevel = new Map();
            Array.from(levels.entries()).forEach(([node, level]) => {
                if (!nodesByLevel.has(level)) {
                    nodesByLevel.set(level, []);
                }
                nodesByLevel.get(level).push(node);
            });
            
            // Add unassigned nodes to level 0
            platforms.forEach(platform => {
                if (!levels.has(platform)) {
                    if (!nodesByLevel.has(0)) {
                        nodesByLevel.set(0, []);
                    }
                    nodesByLevel.get(0).push(platform);
                }
            });
            
            // Use provided container width or default to window width
            const width = containerWidth || window.innerWidth;
            const maxLevel = Math.max(...Array.from(nodesByLevel.keys()));
            const levelSpacing = Math.min(250, (width - 200) / Math.max(1, maxLevel + 1));
            const startX = 50; // Start from left in modal
            const startY = 50;
            const nodeSpacing = 80;
            
            Array.from(nodesByLevel.entries())
                .sort((a, b) => a[0] - b[0])
                .forEach(([level, levelNodes]) => {
                    const yOffset = (levelNodes.length - 1) * nodeSpacing / 2;
                    levelNodes.forEach((node, idx) => {
                        positions.set(node, {
                            x: startX + (level * levelSpacing),
                            y: startY + (idx * nodeSpacing) - yOffset
                        });
                    });
                });
            
            return positions;
        }
        
        function drawDependencyArrowsForVisible(edges, positions) {
            const svg = d3.select('#svg-container');
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            
            edges.forEach(edge => {
                const sourceNode = document.querySelector(`.system-node[data-platform="${edge.source}"]`);
                const targetNode = document.querySelector(`.system-node[data-platform="${edge.target}"]`);
                
                if (!sourceNode || !targetNode) return;
                
                const sourceRect = sourceNode.getBoundingClientRect();
                const targetRect = targetNode.getBoundingClientRect();
                
                // Calculate arrow path relative to SVG
                const sourceX = sourceRect.right - containerRect.left;
                const sourceY = sourceRect.top + sourceRect.height / 2 - containerRect.top;
                const targetX = targetRect.left - containerRect.left;
                const targetY = targetRect.top + targetRect.height / 2 - containerRect.top;
                
                // Create curved path
                const midX = (sourceX + targetX) / 2;
                const path = d3.path();
                path.moveTo(sourceX, sourceY);
                path.quadraticCurveTo(midX, sourceY, targetX, targetY);
                
                svg.append('path')
                    .attr('d', path.toString())
                    .attr('class', 'arrow')
                    .attr('data-source', edge.source)
                    .attr('data-target', edge.target);
            });
        }
        
        /**
         * Define los markers de flecha en el SVG usando D3.js
         * @param {d3.Selection} svg - Selección D3 del elemento SVG donde se definirán los markers
         * @param {string} markerId - ID único para el marker (ej: 'modal-arrowhead-red')
         * @param {Object} options - Opciones de configuración del marker
         * @param {string} options.color - Color de la flecha (default: '#dc3545')
         * @param {number} options.size - Tamaño del marker (default: 12)
         */
        function defineArrowMarker(svg, markerId, options = {}) {
            const color = options.color || '#dc3545';
            const size = options.size || 12;
            
            // Buscar o crear el elemento <defs> en el SVG
            let defs = svg.select('defs');
            if (defs.empty()) {
                defs = svg.append('defs');
            }
            
            // Remover marker existente si existe
            defs.select(`#${markerId}`).remove();
            
            // Crear el marker de flecha
            const marker = defs.append('marker')
                .attr('id', markerId)
                .attr('markerWidth', size)
                .attr('markerHeight', size)
                .attr('refX', size) // Posición donde se une la flecha al path
                .attr('refY', size / 2)
                .attr('orient', 'auto')
                .attr('markerUnits', 'userSpaceOnUse');
            
            // Crear el polígono de la flecha
            marker.append('polygon')
                .attr('points', `0 0, ${size} ${size/2}, 0 ${size}`)
                .attr('fill', color)
                .attr('stroke', options.strokeColor || '#c82333')
                .attr('stroke-width', options.strokeWidth || '1');
            
            return marker;
        }
        
        /**
         * Calcula el punto exacto en el borde de una caja
         * REGLA FIJA: Source siempre borde derecho, Target siempre borde izquierdo
         * Cálculo matemático preciso usando x, y, width, height
         * @param {DOMRect} nodeRect - Bounding rect del nodo
         * @param {DOMRect} containerRect - Bounding rect del contenedor (para coordenadas relativas)
         * @param {string} type - 'source' (borde derecho) o 'target' (borde izquierdo)
         * @param {number} offsetY - Offset vertical para separar múltiples flechas (default: 0)
         * @param {Object} options - Opciones de configuración
         * @param {number} options.gap - Espacio entre el nodo y el punto de conexión (default: 0)
         * @param {number} options.arrowheadMargin - Margen para evitar que arrowhead se monte (default: 10)
         * @returns {Object} Objeto con {x, y}
         */
        function getEdgePoint(nodeRect, containerRect, type = 'source', offsetY = 0, options = {}) {
            const gap = options.gap || 0;
            const arrowheadMargin = options.arrowheadMargin || 10;
            
            // Calcular coordenadas relativas al contenedor usando x, y, width, height
            const nodeX = nodeRect.left - containerRect.left;
            const nodeY = nodeRect.top - containerRect.top;
            const nodeWidth = nodeRect.width;
            const nodeHeight = nodeRect.height;
            const nodeCenterY = nodeY + nodeHeight / 2;
            
            let x, y;
            
            if (type === 'source') {
                // REGLA FIJA: Source siempre sale del borde derecho
                // x = source.x + source.width
                // y = source.y + source.height / 2 (+ offset)
                x = nodeX + nodeWidth + gap;
                y = nodeCenterY + offsetY;
            } else {
                // REGLA FIJA: Target siempre entra por el borde izquierdo
                // x = target.x - margin (para evitar que arrowhead se monte)
                // y = target.y + target.height / 2 (+ offset)
                x = nodeX - gap - arrowheadMargin;
                y = nodeCenterY + offsetY;
            }
            
            return { x, y };
        }
        
        /**
         * Calcula los puntos de conexión entre dos nodos
         * REGLA FIJA: Source borde derecho, Target borde izquierdo
         * @param {DOMRect} sourceRect - Bounding rect del nodo origen
         * @param {DOMRect} targetRect - Bounding rect del nodo destino
         * @param {DOMRect} containerRect - Bounding rect del contenedor (para coordenadas relativas)
         * @param {number} offsetY - Offset vertical para separar múltiples flechas (default: 0)
         * @param {Object} options - Opciones de configuración
         * @returns {Object} Objeto con sourceX, sourceY, targetX, targetY
         */
        function calculateConnectionPoints(sourceRect, targetRect, containerRect, offsetY = 0, options = {}) {
            const sourcePoint = getEdgePoint(sourceRect, containerRect, 'source', offsetY, options);
            const targetPoint = getEdgePoint(targetRect, containerRect, 'target', offsetY, options);
            
            return {
                sourceX: sourcePoint.x,
                sourceY: sourcePoint.y,
                targetX: targetPoint.x,
                targetY: targetPoint.y
            };
        }
        
        /**
         * Crea un path curvo horizontal y suave usando cubic bezier
         * REGLA: Siempre horizontal (derecha → izquierda)
         * Usa d3.linkHorizontal() equivalente con curva Bézier
         * @param {number} sourceX - Coordenada X del punto origen (borde derecho)
         * @param {number} sourceY - Coordenada Y del punto origen (centro vertical + offset)
         * @param {number} targetX - Coordenada X del punto destino (borde izquierdo - margin)
         * @param {number} targetY - Coordenada Y del punto destino (centro vertical + offset)
         * @returns {string} String del path SVG
         */
        function createHorizontalCurvePath(sourceX, sourceY, targetX, targetY) {
            const distanceX = targetX - sourceX;
            const distanceY = targetY - sourceY;
            
            // Curva horizontal suave: usar d3.linkHorizontal() equivalente
            // Control points para curva Bézier horizontal
            // Curvatura proporcional a la distancia vertical (para evitar curvas exageradas)
            const curveFactor = 0.3; // 30% de la distancia horizontal para la curva
            const curveDistance = Math.abs(distanceX) * curveFactor;
            
            // Control points: curva horizontal suave
            // Si hay diferencia vertical, crear una curva S suave
            const verticalOffset = Math.abs(distanceY) * 0.2; // 20% de la diferencia vertical
            
            const control1X = sourceX + curveDistance;
            const control1Y = sourceY + (distanceY > 0 ? verticalOffset : -verticalOffset);
            
            const control2X = targetX - curveDistance;
            const control2Y = targetY - (distanceY > 0 ? verticalOffset : -verticalOffset);
            
            const path = d3.path();
            path.moveTo(sourceX, sourceY);
            path.bezierCurveTo(control1X, control1Y, control2X, control2Y, targetX, targetY);
            
            return path.toString();
        }
        
        /**
         * Calcula offsets consistentes para múltiples flechas que salen del mismo nodo
         * Usa offsets simétricos de +12px y -12px
         * @param {number} index - Índice de la conexión actual (0, 1, 2, ...)
         * @param {number} total - Total de conexiones desde este nodo
         * @returns {number} Offset a aplicar (+12px, -12px, 0, etc.)
         */
        function calculateOffsetForMultipleArrows(index, total) {
            if (total <= 1) return 0;
            
            // Offsets consistentes: +12px, -12px, +24px, -24px, etc.
            const baseOffset = 12;
            
            if (total === 2) {
                // Dos flechas: +12px y -12px
                return index === 0 ? -baseOffset : baseOffset;
            } else {
                // Múltiples flechas: distribuir simétricamente
                const centerIndex = Math.floor(total / 2);
                const offsetFromCenter = index - centerIndex;
                return offsetFromCenter * baseOffset;
            }
        }
        
        /**
         * Función reutilizable para calcular el path de una flecha horizontal entre dos nodos
         * REGLA FIJA: Source borde derecho → Target borde izquierdo
         * @param {DOMRect} sourceRect - Bounding rect del nodo origen
         * @param {DOMRect} targetRect - Bounding rect del nodo destino
         * @param {DOMRect} containerRect - Bounding rect del contenedor
         * @param {number} offsetIndex - Índice para calcular offset (default: 0)
         * @param {number} totalFromSource - Total de flechas desde el nodo origen (default: 1)
         * @param {Object} options - Opciones de configuración
         * @returns {Object} Objeto con {path: string, sourceX, sourceY, targetX, targetY, offsetY}
         */
        function computeHorizontalEdgePath(sourceRect, targetRect, containerRect, offsetIndex = 0, totalFromSource = 1, options = {}) {
            // Calcular offset para separar múltiples flechas (+12px, -12px)
            const offsetY = calculateOffsetForMultipleArrows(offsetIndex, totalFromSource);
            
            // Calcular puntos de conexión exactos en los bordes
            // REGLA: Source siempre borde derecho, Target siempre borde izquierdo
            const points = calculateConnectionPoints(sourceRect, targetRect, containerRect, offsetY, {
                gap: options.gap || 0,
                arrowheadMargin: options.arrowheadMargin || 10
            });
            
            // Crear path curvo horizontal y suave
            const pathString = createHorizontalCurvePath(
                points.sourceX,
                points.sourceY,
                points.targetX,
                points.targetY
            );
            
            return {
                path: pathString,
                sourceX: points.sourceX,
                sourceY: points.sourceY,
                targetX: points.targetX,
                targetY: points.targetY,
                offsetY: offsetY
            };
        }
        
        /**
         * Dibuja las flechas (líneas) que conectan los nodos existentes en el SVG
         * NO modifica ni crea nodos, solo dibuja las conexiones
         * Mejora: Calcula automáticamente el lado correcto de cada nodo y aplica offsets para evitar superposiciones
         * @param {Array} edges - Array de objetos {source: string, target: string} con las conexiones
         * @param {d3.Selection} containerSelection - Selección D3 del contenedor que contiene los nodos
         * @param {d3.Selection} svgSelection - Selección D3 del SVG donde se dibujarán las líneas
         * @param {string} nodeSelector - Selector CSS para encontrar los nodos (default: '.system-node')
         * @param {string} nodeIdAttribute - Atributo que identifica el nodo (default: 'data-platform')
         * @param {string} markerId - ID del marker de flecha a usar (default: 'modal-arrowhead-red')
         * @param {Object} options - Opciones adicionales de estilo
         */
        function drawConnectionArrows(edges, containerSelection, svgSelection, nodeSelector = '.system-node', nodeIdAttribute = 'data-platform', markerId = 'modal-arrowhead-red', options = {}) {
            // Limpiar flechas existentes
            svgSelection.selectAll('path.connection-arrow').remove();
            svgSelection.selectAll('circle.connection-source-marker').remove();
            svgSelection.selectAll('text.connection-source-asterisk').remove();
            
            // Obtener el rectángulo del contenedor para calcular coordenadas relativas
            const containerNode = containerSelection.node();
            if (!containerNode) {
                console.warn('Container node not found');
                return;
            }
            const containerRect = containerNode.getBoundingClientRect();
            
            // Asegurar que el marker existe
            defineArrowMarker(svgSelection, markerId, {
                color: options.arrowColor || '#dc3545',
                strokeColor: options.arrowStrokeColor || '#c82333',
                size: options.arrowSize || 12
            });
            
            // Agrupar edges por nodo origen para calcular offsets
            const edgesBySource = {};
            edges.forEach(edge => {
                if (!edgesBySource[edge.source]) {
                    edgesBySource[edge.source] = [];
                }
                edgesBySource[edge.source].push(edge);
            });
            
            // Dibujar cada conexión usando computeEdgePath
            edges.forEach((edge, globalIndex) => {
                // Buscar los nodos existentes por su atributo identificador
                const sourceNode = containerNode.querySelector(`${nodeSelector}[${nodeIdAttribute}="${edge.source}"]`);
                const targetNode = containerNode.querySelector(`${nodeSelector}[${nodeIdAttribute}="${edge.target}"]`);
                
                if (!sourceNode || !targetNode) {
                    console.warn(`Nodes not found for connection: ${edge.source} -> ${edge.target}`);
                    return;
                }
                
                // Obtener las posiciones de los nodos
                const sourceRect = sourceNode.getBoundingClientRect();
                const targetRect = targetNode.getBoundingClientRect();
                
                // Calcular índice dentro del grupo de flechas del mismo origen
                const sourceEdges = edgesBySource[edge.source];
                const offsetIndex = sourceEdges.findIndex(e => e.target === edge.target);
                const totalFromSource = sourceEdges.length;
                
                // Calcular el path usando la función reutilizable horizontal
                // REGLA FIJA: Source borde derecho → Target borde izquierdo
                const edgePath = computeHorizontalEdgePath(
                    sourceRect,
                    targetRect,
                    containerRect,
                    offsetIndex,
                    totalFromSource,
                    {
                        gap: options.gap || 0,
                        arrowheadMargin: options.arrowheadMargin || 10
                    }
                );
                
                // Dibujar la línea con flecha
                svgSelection.append('path')
                    .attr('class', 'connection-arrow')
                    .attr('d', edgePath.path)
                    .attr('stroke', options.strokeColor || '#dc3545')
                    .attr('stroke-width', options.strokeWidth || '3.5')
                    .attr('fill', 'none')
                    .attr('stroke-linecap', 'round')
                    .attr('stroke-linejoin', 'round')
                    .attr('marker-end', `url(#${markerId})`)
                    .attr('opacity', options.opacity || '1')
                    .attr('filter', options.filter || 'drop-shadow(0 2px 4px rgba(220, 53, 69, 0.4))')
                    .attr('data-source', edge.source)
                    .attr('data-target', edge.target);
                
                // Dibujar círculo con asterisco en el punto de origen (opcional)
                if (options.showSourceMarker !== false) {
                    svgSelection.append('circle')
                        .attr('class', 'connection-source-marker')
                        .attr('cx', edgePath.sourceX)
                        .attr('cy', edgePath.sourceY)
                        .attr('r', options.sourceMarkerRadius || 8)
                        .attr('fill', options.sourceMarkerColor || '#dc3545')
                        .attr('stroke', options.sourceMarkerStroke || '#ffffff')
                        .attr('stroke-width', options.sourceMarkerStrokeWidth || '2')
                        .attr('opacity', '1');
                    
                    svgSelection.append('text')
                        .attr('class', 'connection-source-asterisk')
                        .attr('x', edgePath.sourceX)
                        .attr('y', edgePath.sourceY)
                        .attr('text-anchor', 'middle')
                        .attr('dominant-baseline', 'central')
                        .attr('fill', '#ffffff')
                        .attr('font-size', options.sourceMarkerFontSize || '10px')
                        .attr('font-weight', 'bold')
                        .attr('pointer-events', 'none')
                        .text('*');
                }
            });
        }
        
        /**
         * Función principal para dibujar flechas en el modal (wrapper para mantener compatibilidad)
         * @param {Array} edges - Array de conexiones {source, target}
         * @param {Object} positions - Map de posiciones (no usado, mantenido para compatibilidad)
         * @param {d3.Selection} modalSystems - Selección D3 del contenedor de nodos
         * @param {d3.Selection} modalSvg - Selección D3 del SVG
         */
        function drawDependencyArrowsInModal(edges, positions, modalSystems, modalSvg) {
            // Usar la función reutilizable con opciones optimizadas
            drawConnectionArrows(
                edges,
                modalSystems,
                modalSvg,
                '.system-node',           // Selector de nodos
                'data-platform',          // Atributo identificador
                'modal-arrowhead-red',    // ID del marker
                {
                    gap: 0,                    // Sin gap inicial (anclaje exacto al borde)
                    arrowheadMargin: 10,       // Margen de 10px para evitar que arrowhead se monte
                    strokeColor: '#dc3545',
                    strokeWidth: '3.5',
                    showSourceMarker: true,
                    sourceMarkerRadius: 8
                }
            );
        }
        
        // Modal close functionality
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('dependencyModal');
            const closeBtn = document.getElementById('closeModal');
            
            closeBtn.onclick = function() {
                modal.style.display = 'none';
                // Hide tooltip when modal closes
                d3.selectAll('.obligation-tooltip').style('display', 'none');
            };
            
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                    // Hide tooltip when modal closes
                    d3.selectAll('.obligation-tooltip').style('display', 'none');
                }
            };
        });
        
        function drawDependencyArrows(svg, nodes, positions, edges) {
            const systemsSection = document.querySelector('#systems');
            const systemsRect = systemsSection.getBoundingClientRect();
            const containerRect = document.querySelector('.container').getBoundingClientRect();
            
            edges.forEach(edge => {
                const sourcePos = positions.get(edge.source);
                const targetPos = positions.get(edge.target);
                
                if (!sourcePos || !targetPos) return;
                
                // Get actual positions of system nodes
                const sourceNode = document.querySelector(`.system-node[data-platform="${edge.source}"]`);
                const targetNode = document.querySelector(`.system-node[data-platform="${edge.target}"]`);
                
                if (!sourceNode || !targetNode) return;
                
                const sourceRect = sourceNode.getBoundingClientRect();
                const targetRect = targetNode.getBoundingClientRect();
                
                // Calculate arrow path relative to SVG
                const sourceX = sourceRect.right - containerRect.left;
                const sourceY = sourceRect.top + sourceRect.height / 2 - containerRect.top;
                const targetX = targetRect.left - containerRect.left;
                const targetY = targetRect.top + targetRect.height / 2 - containerRect.top;
                
                // Create curved path
                const midX = (sourceX + targetX) / 2;
                const path = d3.path();
                path.moveTo(sourceX, sourceY);
                path.quadraticCurveTo(midX, sourceY, targetX, targetY);
                
                svg.append('path')
                    .attr('d', path.toString())
                    .attr('class', 'arrow')
                    .attr('data-source', edge.source)
                    .attr('data-target', edge.target);
            });
        }
        
        function drawDocumentTypeConnections(svg, docToPlatforms, platformPositions) {
            // This can be used to draw lines from document types to platforms if needed
            // For now, we'll use hover highlighting instead
        }
        
        function highlightPlatforms(platformNames, highlight) {
            d3.selectAll('.system-node')
                .classed('highlighted', function() {
                    return highlight && platformNames.includes(d3.select(this).attr('data-platform'));
                });
        }
        
        function highlightDocumentType(docType, platforms) {
            // Reset all highlights
            d3.selectAll('.document-type-box').classed('highlighted', false);
            d3.selectAll('.system-node').classed('highlighted', false);
            d3.selectAll('.arrow').classed('highlighted', false);
            
            // Highlight selected document type
            d3.selectAll('.document-type-box')
                .filter(d => d === docType)
                .classed('highlighted', true);
            
            // Highlight connected platforms
            highlightPlatforms(platforms, true);
        }
        
        function highlightSystemPath(platformName, nodes) {
            // Reset all highlights
            d3.selectAll('.document-type-box').classed('highlighted', false);
            d3.selectAll('.system-node').classed('highlighted', false);
            d3.selectAll('.arrow').classed('highlighted', false);
            
            // Highlight the platform and its dependency chain
            const visited = new Set();
            const toVisit = [platformName];
            
            while (toVisit.length > 0) {
                const current = toVisit.shift();
                if (visited.has(current)) continue;
                visited.add(current);
                
                // Highlight this node
                d3.selectAll('.system-node')
                    .filter(function() {
                        return d3.select(this).attr('data-platform') === current;
                    })
                    .classed('highlighted', true);
                
                // Highlight arrows pointing to this node
                d3.selectAll('.arrow')
                    .filter(function() {
                        return d3.select(this).attr('data-target') === current;
                    })
                    .classed('highlighted', true);
                
                // Add dependencies to visit
                const node = Array.from(nodes.entries()).find(([name]) => name === current);
                if (node && node[1].dependencies) {
                    node[1].dependencies.forEach(dep => {
                        if (!visited.has(dep)) {
                            toVisit.push(dep);
                        }
                    });
                }
            }
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // Could re-layout on resize if needed
        });
    </script>
</body>
</html>

